{"ts":1362360711893,"silentsave":true,"restoring":false,"patch":[[{"diffs":[[1,"if(typeof(engine) == \"undefined\"){\n\talert('game engine not loaded..');\n}\n$(function(){\n\tvar planeMarkers = [];\n\tvar airportMarkers = [];\n        var mapOptions = {\n          center: new google.maps.LatLng(-34.397, 150.644),\n          zoom: 8,\n          mapTypeId: google.maps.MapTypeId.ROADMAP\n        };\n        map = new google.maps.Map(document.getElementById(\"map_canvas\"),\n            mapOptions);\n\n\tgoogle.maps.event.addListener(map, 'center_changed', function() {\n\t\tengine.force_ui_update();\n\t});\n\n\tgoogle.maps.event.addListener(map, 'zoom_changed', function() {\n\t\tengine.force_ui_update();\n\t});\n\tengine.callbacks.logging_callback = function(data){\n\t\t$(\".log\").append(data + \"<br />\");\n\t};\n\tengine.callbacks.plane_status_changed = function(p){\n\t\tupdate_plane_status(p);\n\t};\n\tengine.callbacks.airport_status_changed = function(a){\n\t\tupdate_airport_status(a);\n\t};\n\tengine.callbacks.cash_changed_hands = function(amount,reason){\n\t\t$(\".cash_changed_hands\").show();\n\t\t$(\".cash_changed_hands\").text(\"$\"+amount);\n\t\t$(\".cash_changed_hands\").fadeOut(1500);\n\t};\n\tengine.callbacks.no_money = function(amount,reason){\n\t\talert('you ran out of money - wait for money or start again. Amount needed to continue: ' + amount);\n\t};\n\tfunction get_image(type){\n\t\tif(type == \"people\"){\n\t\t\treturn \"<img src='personIcon.gif'>\";\n\t\t}else{\n\t\t\treturn \"<img src='box_48.png' style='height: 16px; width: 16px;'>\";\n\t\t}\n\t}\n\tfunction update_airport_status(a){\n\t\t//find marker and remove.\n\t\tfor(var i=airportMarkers.length-1;i>=0;i--){\n\t\t\tif(airportMarkers[i].id === a.id){\n\t\t\t\tairportMarkers[i].airport_marker.setMap(null);\n\t\t\t\tairportMarkers.splice(i,1);\n\t\t\t}\n\t\t}\n\n\t\tif(a.activated ===true){\n\t\t\t//remake marker.\n\t\t\tvar latlng = new google.maps.LatLng(a.position.latitude,a.position.longitude);\n\t\t\t\n\t\t\tvar airportMarker = new MarkerWithLabel({\n\t\t\t\t\tmap: map,\n\t\t\t\t\tlabelText: \"<img src='http://google-maps-icons.googlecode.com/files/airport.png' class='airport_marker_image' id='airport_marker_\" + a.id + \"' />\" + a.id,\n\t\t\t\t\tlabelClass: 'airportLabel',\n\t\t\t\t\tlabelVisible: true,\n\t\t\t\t\ticon: \"http://maps.google.com/mapfiles/ms/icons/z.png\"\n\t\t\t\t});\n\t\t\tairportMarker.setPosition(latlng);\n\t\t\tairportMarkers.push({id:a.id,airport_marker:airportMarker});\n\t\t}\n\n\t}\n\tfunction update_plane_status(p){\n\t\t//if the DIV for this plane doesn't exist, add it.\n\t\t\tvar div_exists = $(\"#plane_window_\" + p.id).length !== 0;\n\t\t\tif(!div_exists){\n\t\t\t\tvar h = \"<div id='plane_window_\"+p.id+\"' class='plane_summary'>Plane window ID \" + p.id + \"<br />\";\n\t\t\t\th +=\"<div class='data-wrapper'>Status: <span class='plane_status emphasis'></span><br />\";\n\t\t\t\th +=\"<span class='arrives_in'></span><br />\";\n\t\t\t\th +=\"<span class='destination'></span><br />\";\n\t\t\t\th +=\"<br />Passengers aboard:<br /><div class='passenger_manifest'></div><br />\";\n\t\t\t\th +=\"<br />Jobs available:<br /><div class='job_sheet'></div><br />\";\n\t\t\t\th +=\"<br />Destinations available:<br /><div class='destinations'></div><br />\";\n\t\t\t\th += \"</div></div>\";\n\t\t\t\t$(\".planes_window\").append(h);\n\n\t\t\t\t//if the div doesn't exist, there's probably no map marker either. add it.\n\t\t\t\t/*var planeMarker = new google.maps.Marker();\n\t\t\t\tplaneMarker.setMap(map);*/\n\t\t\t\tvar planeMarker = new MarkerWithLabel({\n\t\t\t\t\tmap: map,\n\t\t\t\t\tlabelText: \"<img class='plane_marker_image' data-plane-id='\" + p.id + \"' src='http://maps.google.com/mapfiles/ms/icons/plane.png' id='plane_marker_\" + p.id + \"' />\" + p.id,\n\t\t\t\t\tlabelClass: 'markerLabel',\n\t\t\t\t\tlabelVisible: true,\n\t\t\t\t\ticon: \"http://maps.google.com/mapfiles/ms/icons/z.png\"\n\t\t\t\t});\n\t\t\t\tplaneMarkers.push({plane_id:p.id,plane_marker:planeMarker});\n\n\t\t\t\t//add a summary list item too.\n\t\t\t\tvar li = \"<li id='plane_summary_\" + p.id + \"' class='plane_summary_item clickable' data-plane-id='\" + p.id + \"'></li>\";\n\t\t\t\t$(\".plane_list\").append(li);\n\n\t\t\t\t//hide all cards again.\n\t\t\t\t$(\".plane_summary\").hide();\n\t\t\t}\n\t\t\tvar thisMarker;\n\t\t\tplaneMarkers.forEach(function(marker){\n\t\t\t\tif(marker.plane_id == p.id){\n\t\t\t\t\tthisMarker = marker;\n\t\t\t\t}\n\t\t\t});\n\n\n\t\t\tvar latlng = new google.maps.LatLng(p.position.latitude,p.position.longitude);\n\t\t\tthisMarker.plane_marker.setPosition(latlng);\n\n\t\t\tvar pwin = $(\"#plane_window_\" + p.id).children(\".data-wrapper\");\n\t\t\tvar psum = $(\"#plane_summary_\" + p.id);\n\t\t\t//status, arrival time, destination/location\n\t\t\tpwin.children(\".plane_status\").text(p.status);\n\t\t\tpsum.html(\"\");\n\t\t\tvar sum_text = \"\";\n\t\t\tsum_text += p.id + \" \" + p.status;\n\t\t\tsum_text +=\": \" + p.next_airport_object.name;\n\t\t\tif(p.status == \"enroute\"){\n\t\t\t\tpwin.children(\".arrives_in\").text(\"Arrives in \" + lookup.seconds_until_arrival(p.id));\n\t\t\t\tpwin.children(\".destination\").text(\"Destination \" + p.next_airport_object.name);\n\t\t\t\tsum_text +=\" in \" + lookup.seconds_until_arrival(p.id);\n\t\t\t\tvar rise = p.next_airport_object.position.latitude - p.last_airport_object.position.latitude;\n\t\t\t\t\t\t\tvar run =p.next_airport_object.position.longitude- p.last_airport_object.position.longitude;\n\t\t\t\t\t\t\tvar rotation_angle = lookup.get_angle_to_rotate(rise,run);\n\t\t\t\t\t\t\t$(\"#plane_marker_\" + p.id).rotate(rotation_angle);\n\t\t\t}else{\n\t\t\t\tpwin.children(\".arrives_in\").text(\"\");\n\t\t\t\tpwin.children(\".destination\").text(\"At \" + p.next_airport_object.name);\n\n\t\t\t}\n\n\t\t\t//passenger manifest\n\t\t\tvar passenger_count=0;\n\t\t\tvar cargo_count=0;\n\t\t\tpwin.children(\".passenger_manifest\").text(\"\");\n\t\t\tif(p.jobs_onboard.length > 0){\n\t\t\t\tp.jobs_onboard.forEach(function(job){\n\t\t\t\t\tif(job.type == \"people\"){\n\t\t\t\t\t\tpassenger_count+=1;\n\t\t\t\t\t}else{\n\t\t\t\t\t\tcargo_count+=1;\n\t\t\t\t\t}\n\t\t\t\t\tpwin.children(\".passenger_manifest\").append(\"<span class='passenger_on_plane clickable' data-plane-id='\" + p.id + \"' data-job-id='\" + job.id + \"'>\"  + get_image(job.type) + \" \" + \" \" + job.name + \" Destination: \" + lookup.lookup_airport_by_id(job.destination).name + \"</span><br />\");\n\t\t\t\t});\n\t\t\t}else{\n\t\t\t\tpwin.children(\".passenger_manifest\").append(\"(No passengers aboard)\");\n\t\t\t}\n\t\t\tsum_text += \" \" + passenger_count + get_image(\"people\") + \" \" + \"&nbsp; \" + cargo_count+ get_image(\"cargo\");\n\t\t\tpsum.html(sum_text);\n\t\t\t//jobsheet\n\t\t\tpwin.children(\".job_sheet\").text(\"\");\n\t\t\tvar loaded_people = 0;\n\t\t\tvar loaded_cargo = 0;\n\t\t\tp.jobs_onboard.forEach(function(job){\n\t\t\t\tif(job.type == \"people\"){\n\t\t\t\t\tloaded_people +=1;\n\t\t\t\t}\n\t\t\t\tif(job.type == \"cargo\"){\n\t\t\t\t\tloaded_cargo +=1;\n\t\t\t\t}\n\t\t\t});\n\t\t\tpwin.children(\".job_sheet\").html(\"\");\n\t\t\tpwin.children(\".destinations\").html(\"\");\n\t\t\tif(p.status == \"grounded\"){\n\t\t\t\tvar ap_jobs = engine.get_jobs(p.next_airport_id);\n\t\t\t\t\n\t\t\t\tap_jobs.forEach(function(job){\n\t\t\t\t\tvar ap = lookup.lookup_airport_by_id(job.destination);\n\t\t\t\t\tif(job.type == \"people\" && loaded_people < p.capacity_people && ap.activated){\n\t\t\t\t\t\tpwin.children(\".job_sheet\").append(\"<span class='selectable_job clickable' data-job-id='\" + job.id + \"' data-plane-id='\" + p.id + \"''>\" + get_image(job.type) + \" \" +job.name + \" \" +  ap.name + \"</span><br />\");\n\t\t\t\t\t}\n\t\t\t\t\tif(job.type == \"cargo\" && loaded_cargo < p.capacity_cargo && ap.activated){\n\t\t\t\t\t\tpwin.children(\".job_sheet\").append(\"<span class='selectable_job clickable' data-job-id='\" + job.id + \"' data-plane-id='\" + p.id + \"''>\" + get_image(job.type) + \" \" + job.name + \" \" + ap.name + \"</span><br />\");\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t//destinations\n\t\t\t\n\t\t\t\t\n\t\t\t\t//give the user options where to send the plane.\n\t\t\t\tvar airports = engine.state_object.airports;\n\t\t\t\tairports.forEach(function(airport){\n\t\t\t\t\tif(airport != p.next_airport_object && airport.activated){\n\t\t\t\t\t\tpwin.children(\".destinations\").append(\"<span class='selectable_destination clickable' data-plane-id='\" + p.id + \"' data-to-airport='\" + airport.id + \"' data-from-airport='\" + p.next_airport_object.id + \"'> \"+airport.name+\"</span><br />\");\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\n\n\t\t\tvar money = engine.state_object.money;\n\t\t\t$(\".money_available\").text(money);\n\t}\n\n\t//events.\n\t\t$(document).on('click','.selectable_destination',function(){\n\t//$(\".selectable_destination\").on('click',function(){\n\t\tvar from_airport_id = $(this).attr('data-from-airport');\n\t\tvar to_airport_id = $(this).attr('data-to-airport');\n\t\tvar plane_id = parseInt($(this).attr('data-plane-id'),10);\n\t\tvar plane = lookup.lookup_plane_by_id(plane_id);\n\t\tvar from_airport = lookup.lookup_airport_by_id(from_airport_id);\n\t\tvar to_airport = lookup.lookup_airport_by_id(to_airport_id);\n\t\tvar flight_distance = lookup.get_distance(from_airport.position,to_airport.position);\n\t\tvar flight_time = lookup.get_flight_time(flight_distance, plane);\n\t\tvar flight_cost = lookup.get_flight_cost(flight_distance, plane);\n\t\tengine.debug(from_airport.name + \" to \" + to_airport.name + \" is \" + flight_distance + \" will take \" + flight_time + \" and will cost \" + flight_cost);\n\t\tif(engine.send_aircraft(plane_id,to_airport_id)){\n\t\t\t\t\tshow_map();\n\t\t}\n\t});\n\t\t$(document).on('click','.selectable_job',function(){\n\t\tvar job_id = $(this).attr('data-job-id');\n\t\tvar plane_id = $(this).attr('data-plane-id');\n\t\tengine.assign_job_to_plane(plane_id, job_id);\n\t});\n\t$(document).on('click','.passenger_on_plane',function(){\n\t\t//drop job off at airport if the plane is grounded.\n\t\tvar job_id = $(this).attr('data-job-id');\n\t\t\tvar plane_id = $(this).attr('data-plane-id');\n\t\tengine.drop_job_at_this_airport(job_id,plane_id);\n\t});\n\t\n\t$(document).on('click','.plane_summary_item',function(){\n\t\t//show relevant plane detail card.\n\t\t\tvar id = $(this).attr('data-plane-id');\n\t\t\t$(\".plane_summary\").hide();\n\t\t\thide_map();\n\t\t\thide_instructions();\n\t\t$(\"#plane_window_\"+id).show();\n\t});\n\t$(document).on('click','.show_map',function(){\n\t//$(\".show_map\").on('click',function(){\n\t\tshow_map();\n\t\thide_instructions();\n\t});\n\t$(document).on('click','.start_game',function(){\n\t//$(\".start_game\").on('click',function(){\n\t\thide_instructions();\n\t\tshow_map();\n\t});\n\t$(document).on('click','.plane_marker_image',function(){\n\t//$(\".plane_marker_image\").on('click',function(){\n\t\t//show relevant plane detail card.\n\t\t\tvar id = $(this).attr('data-plane-id');\n\t\t\t$(\".plane_summary\").hide();\n\t\t\thide_instructions();\n\t\t\thide_map();\n\t\t$(\"#plane_window_\"+id).show();\n\t});\n\tshow_map = function(){\n\t\t//$(\".map_wrapper\").show();\n\t\t$(\".plane_summary\").hide();\n\t\t$(\".map_wrapper\").css({'height':'400px'});\n\t};\n\thide_map = function(){\n\t\t$(\".map_wrapper\").css({'height':'0px'});\n\t};\n\thide_instructions = function(){\n\t\t$(\".instructions\").hide();\n\t\t\n\t};\n\t//final setup\n\tengine.force_ui_update();\n\t//\n\n//set up map bounds to airports.\n\t\t\tvar lowest_lat = 0;\n\t\t\tvar highest_lat = 0;\n\t\t\tvar lowest_long = 0;\n\t\t\tvar highest_long = 0;\n\t\t\tengine.state_object.airports.forEach(function(airport){\n\t\t\t\tif(airport.position.latitude < lowest_lat || lowest_lat === 0){\n\t\t\t\t\tlowest_lat = airport.position.latitude;\n\t\t\t\t}\n\t\t\t\tif(airport.position.longitude < lowest_long || lowest_long === 0){\n\t\t\t\t\tlowest_long = airport.position.longitude;\n\t\t\t\t}\n\t\t\t\tif(airport.position.latitude > highest_lat || highest_lat === 0){\n\t\t\t\t\thighest_lat = airport.position.latitude;\n\t\t\t\t}\n\t\t\t\tif(airport.position.longitude >    highest_long || highest_long === 0){\n\t\t\t\t\thighest_long = airport.position.longitude;\n\t\t\t\t}\n\t\t\t});\n\t\t\tvar latlngbounds = new google.maps.LatLngBounds(new google.maps.LatLng(lowest_lat, lowest_long),new google.maps.LatLng(highest_lat, highest_long));\n\t\t\tmap.fitBounds(latlngbounds);\n\t\t\thide_map();\n});"]],"start1":0,"start2":0,"length1":0,"length2":11167}]],"length":11167}
{"ts":1362361495674,"patch":[[{"diffs":[[0,"d + \"'><"],[1,"span class='summary_id'></span><span class='summary_status'></span><span class='summary_airport'></span>\" + get_image(\"people\") + \"<span class='summary_people'></span>\" + get_image(\"cargo\") + \"<span class='summary_cargo'></span><"],[0,"/li>\";\n\t"]],"start1":3735,"start2":3735,"length1":16,"length2":245}]],"length":11396,"saved":false}
{"ts":1362361557037,"patch":[[{"diffs":[[0,"status);\n\t\t\t"],[1,"//"],[0,"psum.html(\"\""]],"start1":4544,"start2":4544,"length1":24,"length2":26},{"diffs":[[0,"o\");\n\t\t\t"],[1,"psum.children(\"people\").text(passenger_count);\n            //"],[0,"psum.htm"]],"start1":6197,"start2":6197,"length1":16,"length2":77}]],"length":11459,"saved":false}
{"ts":1362361634136,"patch":[[{"diffs":[[0,"t = \"\";\n"],[1,"            psum.children(\".summary_id\").text(p.id);\n            psum.children(\".summary_status\").text(p.status);\n            psum.children(\".summary_airport\").text(p.airport);\n"],[0,"\t\t\tsum_t"]],"start1":4587,"start2":4587,"length1":16,"length2":193},{"diffs":[[0,"\n\t\t\t"],[1,"p"],[0,"sum"],[-1,"_text += \" \" + passenger_count + get_image(\"people\") + \" \" + \"&nbsp; \" + cargo_count+ get_image(\"cargo\");\n\t\t\t"],[1,".children(\".people\").text(passenger_count);\n            "],[0,"psum"]],"start1":6266,"start2":6266,"length1":120,"length2":68},{"diffs":[[0,"ildren(\""],[-1,"people"],[1,".cargo"],[0,"\").text("],[-1,"passenger"],[1,"cargo"],[0,"_count);"]],"start1":6337,"start2":6337,"length1":39,"length2":35}]],"length":11580,"saved":false}
{"ts":1362361663856,"patch":[[{"diffs":[[0,"\");\n"],[-1,"\t\t\tvar sum_text = \"\";\n"],[0,"    "]],"start1":4569,"start2":4569,"length1":30,"length2":8},{"diffs":[[0,";\n\t\t"],[-1,"\tsum_text += p.id + \" \" + p.status;\n\t\t\tsum_text +=\": \" + p.next_airport_object.name;"],[0,"\n\t\t\t"]],"start1":4748,"start2":4748,"length1":92,"length2":8},{"diffs":[[0,".name);\n"],[-1,""],[0,"\t\t\t"],[1,"//"],[0,"\tsum_tex"]],"start1":4951,"start2":4951,"length1":19,"length2":21}]],"length":11476,"saved":false}
{"ts":1362361744463,"patch":[[{"diffs":[[0,"ldren(\"."],[1,"summary_"],[0,"people\")"]],"start1":6174,"start2":6174,"length1":16,"length2":24},{"diffs":[[0,"ldren(\"."],[1,"summary_"],[0,"cargo\")."]],"start1":6242,"start2":6242,"length1":16,"length2":24}]],"length":11492,"saved":false}
{"ts":1362362381956,"patch":[[{"diffs":[[0,"_status'></span>"],[1," "],[0,"<span class='sum"]],"start1":3794,"start2":3794,"length1":32,"length2":33},{"diffs":[[0,"airport'></span>"],[1," <span class='summary_arrival_delta'></span> "],[0,"\" + get_image(\"p"]],"start1":3832,"start2":3832,"length1":32,"length2":77},{"diffs":[[0,"></span>"],[1," "],[0,"\" + get_"]],"start1":3948,"start2":3948,"length1":16,"length2":17},{"diffs":[[0,"s);\n"],[-1,"\t\t\t//psum.html(\"\");\n"],[0,"    "]],"start1":4596,"start2":4596,"length1":28,"length2":8},{"diffs":[[0,"e);\n"],[-1,"\t\t\t//\tsum_"],[1,"            psum.children(\".summary_arrival_delta\")."],[0,"text"],[-1," +="],[1,"("],[0,"\" in"]],"start1":4982,"start2":4982,"length1":25,"length2":65},{"diffs":[[0,"rrival(p.id)"],[1,")"],[0,";\n\t\t\t\tvar ri"]],"start1":5074,"start2":5074,"length1":24,"length2":25}]],"length":11560,"saved":false}
{"contributors":[],"silentsave":false,"ts":1362434665586,"patch":[[{"diffs":[[0,"></span>"],[1," "],[0,"<span cl"]],"start1":3766,"start2":3766,"length1":16,"length2":17},{"diffs":[[0,").text(\""],[1,"arrives"],[0," in \" + "]],"start1":5037,"start2":5037,"length1":16,"length2":23}]],"length":11568,"saved":false}
{"ts":1362434734821,"patch":[[{"diffs":[[0,"_plane clickable"],[1," \" + get_image(job.type) + \""],[0,"' data-plane-id="]],"start1":5926,"start2":5926,"length1":32,"length2":60},{"diffs":[[0,"\"'>\""],[-1,"  + get_image(job.type) + \" \""],[0," + \""]],"start1":6027,"start2":6027,"length1":37,"length2":8}]],"length":11567,"saved":false}
{"ts":1362437993877,"patch":[[{"diffs":[[0,"type"],[-1,"){\n\t\tif(type == \"people\"){\n\t\t\treturn \"<img src='personIcon.gif'>\";\n\t\t}else{\n\t\t\treturn \"<img src='box_48.png' style='height: 16px; width: 16px;'>\";\n\t\t"],[1,",use_image_tag){\n        var person_src = \"personIcon.gif\";\n        var cargo_src= = \"box_48.png\";\n        var output_image = \"\";\n\t\tif(type == \"people\"){\n\t\t\toutput_image = person_src;\n\t\t}else{\n            output_image = cargo_src;\n\t\t\treturn \"<img src='' style='height: 16px; width: 16px;'>\";\n\t\t}\n        if(image_tag){\n            return \"<img src='\" + output_image + \"' style='height: 16px; width: 16px;'>\";\n        }else{\n            return  output_image;\n        "],[0,"}\n\t}"]],"start1":1240,"start2":1240,"length1":157,"length2":474}]],"length":11884,"saved":false}
{"ts":1362438038225,"patch":[[{"diffs":[[0,"age(job.type"],[1,",false"],[0,") + \"' data-"]],"start1":6270,"start2":6270,"length1":24,"length2":30}]],"length":11890,"saved":false}
{"ts":1362438062013,"patch":[[{"diffs":[[0,"\"people\""],[1,",true"],[0,") + \"<sp"]],"start1":4225,"start2":4225,"length1":16,"length2":21},{"diffs":[[0,"(\"cargo\""],[1,",true"],[0,") + \"<sp"]],"start1":4293,"start2":4293,"length1":16,"length2":21},{"diffs":[[0,"t_image(job.type"],[1,",true"],[0,") + \" \" +job.nam"]],"start1":7500,"start2":7500,"length1":32,"length2":37},{"diffs":[[0,"job.type"],[1,",true"],[0,") + \" \" "]],"start1":7818,"start2":7818,"length1":16,"length2":21}]],"length":11910,"saved":false}
{"ts":1362438112306,"patch":[[{"diffs":[[0,"rgo_src="],[-1," ="],[0," \"box_48"]],"start1":1318,"start2":1318,"length1":18,"length2":16}]],"length":11908,"saved":false}
{"ts":1362438150179,"patch":[[{"diffs":[[0,"     if("],[1,"typeof("],[0,"image_ta"]],"start1":1541,"start2":1541,"length1":16,"length2":23},{"diffs":[[0,"ypeof(image_tag)"],[1," != \"undefined\" && image_tag == true)"],[0,"{\n            re"]],"start1":1550,"start2":1550,"length1":32,"length2":69}]],"length":11952,"saved":false}
